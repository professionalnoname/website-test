<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Repository</title>
    <style>
        :root {
            --text-primary: #2d3436;
            --bg-primary: #f8f9fa;
            --accent: #2980b9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease-out forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 300;
            color: var(--text-primary);
        }

        .folder {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
            opacity: 0;
            transform: translateY(10px);
            animation: itemEnter 0.4s ease-out forwards;
        }

        @keyframes itemEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .folder:hover {
            transform: translateY(-2px);
        }

        .folder-header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #eee;
        }

        .folder-icon {
            transition: transform 0.2s ease;
        }

        .folder-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .file-item {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--accent);
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .file-item:hover {
            background: rgba(41, 128, 185, 0.05);
        }

        .file-details {
            color: #7f8c8d;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .loading {
            text-align: center;
            color: #7f8c8d;
            padding: 2rem;
        }
    </style>
</head>
<body>
    <canvas id="shaderCanvas"></canvas>
    <div class="container">
        <h1>Software Repository</h1>
        <div id="repository" class="loading">Loading...</div>
    </div>

<script>
    (function() {
        // WebGL Shader
        const vertexShader = `
            attribute vec2 position;
            void main() {
                gl_Position = vec4(position, 0.0, 1.0);
            }
        `;

        const fragmentShader = `
            precision highp float;
            uniform vec2 resolution;
            uniform float time;

            void main() {
                vec2 uv = gl_FragCoord.xy/resolution.xy;
                vec3 color = vec3(0.1);

                // Animated gradient
                float wave = sin(time + uv.x * 3.0) * 0.1;
                color.r += smoothstep(0.4, 0.6, uv.y + wave);
                color.g += smoothstep(0.3, 0.7, uv.y - wave);

                // Subtle noise
                color += fract(sin(dot(uv, vec2(12.9898,78.233))) * 43758.5453) * 0.02;

                gl_FragColor = vec4(color, 0.15);
            }
        `;

        function initShader() {
            const canvas = document.getElementById('shaderCanvas');
            const gl = canvas.getContext('webgl');

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                gl.viewport(0, 0, canvas.width, canvas.height);
            }

            const vertices = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

            const vertexShaderObj = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vertexShaderObj, vertexShader);
            gl.compileShader(vertexShaderObj);

            const fragmentShaderObj = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fragmentShaderObj, fragmentShader);
            gl.compileShader(fragmentShaderObj);

            const program = gl.createProgram();
            gl.attachShader(program, vertexShaderObj);
            gl.attachShader(program, fragmentShaderObj);
            gl.linkProgram(program);
            gl.useProgram(program);

            const positionLocation = gl.getAttribLocation(program, "position");
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            const resolutionLocation = gl.getUniformLocation(program, "resolution");
            const timeLocation = gl.getUniformLocation(program, "time");

            resize();
            window.addEventListener('resize', resize);

            function animate(time) {
                gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
                gl.uniform1f(timeLocation, performance.now() / 1000);
                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                requestAnimationFrame(animate);
            }
            animate(0);
        }

        // Repository Logic
        async function fetchRepository() {
            try {
                const response = await fetch('https://tatsi.eu/repo.json', {
                    cache: 'force-cache'
                });

                if (!response.ok) throw new Error(response.statusText);
                const data = await response.json();

                document.getElementById('repository').classList.remove('loading');
                renderRepository(data.folders);
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('repository').innerHTML =
                    '<p class="error">Error loading repository. Please try again later.</p>';
            }
        }

        function renderRepository(folders) {
            const container = document.getElementById('repository');
            const fragment = document.createDocumentFragment();

            folders.forEach((folder, index) => {
                const folderElement = document.createElement('div');
                folderElement.className = 'folder';
                folderElement.style.animationDelay = `${index * 0.1}s`;

                const header = document.createElement('div');
                header.className = 'folder-header';
                header.innerHTML = `<span class="folder-icon">â–¾</span> ${folder.name}`;
                header.onclick = () => toggleFolder(folderElement);

                const content = document.createElement('div');
                content.className = 'folder-content';

                folder.files.forEach(file => {
                    const fileLink = document.createElement('a');
                    fileLink.className = 'file-item';
                    fileLink.href = file.url;
                    fileLink.innerHTML = `${file.name}<span class="file-details">${file.size}</span>`;
                    content.appendChild(fileLink);
                });

                folderElement.append(header, content);
                fragment.appendChild(folderElement);
            });

            container.innerHTML = '';
            container.appendChild(fragment);
        }

        function toggleFolder(folder) {
            const content = folder.querySelector('.folder-content');
            const icon = folder.querySelector('.folder-icon');

            content.style.maxHeight = content.style.maxHeight ?
                null : content.scrollHeight + 'px';
            icon.style.transform = content.style.maxHeight ?
                'rotate(0deg)' : 'rotate(-90deg)';
        }

        // Initialize
        initShader();
        fetchRepository();
    })();
</script>
</body>
</html>
